# 竞赛智能客服系统

## 项目概述

本系统是基于最新人工智能技术开发的高效智能客服机器人，专门针对各类竞赛提供精准问答服务。系统采用创新的RAG（检索增强生成）和MCP（模型-上下文协议）双引擎技术，能够快速、准确地回答用户关于16个竞赛类型的基本信息、要求、评分标准等问题。

## 🌟 系统特点

- **纯WebSocket通信**：摒弃HTTP API，采用WebSocket实现真正的实时双向通信，提供更流畅的用户体验
- **多竞赛知识库覆盖**：涵盖泰迪杯数据挖掘挑战赛、3D编程模型创新设计专项赛等16个竞赛的完整信息
- **双引擎智能检索**：结合结构化知识库和语义搜索，确保回答的准确性和相关性  
- **实时调试能力**：完善的DEBUG日志系统，支持实时问题追踪和系统诊断
- **精准答案生成**：先进的MCP与RAG技术结合，避免"答非所问"问题
- **智能连接管理**：自动重连机制、会话状态管理、连接状态指示器
- **美观交互界面**：响应式设计，提供直观的用户体验和系统功能展示

## 🏗️ 系统架构

### 核心技术架构

```
用户问题 → WebSocket通信 → 问题增强器 → 查询路由器 → 双引擎处理 → 响应格式化 → WebSocket返回
                ↓                    ↓                 ↓
        实时双向通信         关键词提取优化    ┌─结构化知识库引擎
        会话状态管理         同义词扩展      │ (精确匹配)
        自动重连机制         竞赛类型识别    └─语义搜索引擎
                                         (模糊匹配)
```

### 主要组件

1. **问题增强模块** (`app/utils/question_enhancer.py`)
   - 智能关键词提取和扩展
   - 竞赛类型自动识别
   - 问题质量评估和优化

2. **双引擎查询系统**
   - **结构化知识库** (`app/models/structured_kb.py`)：处理明确的竞赛+信息类型问题
   - **语义搜索引擎** (`app/models/enhanced_rag.py`)：处理复杂或开放性问题

3. **查询路由器** (`app/models/query_router.py`)
   - 智能路由到最适合的引擎
   - 基于问题特征的自动分发
   - 置信度比较和结果优选

4. **响应格式化系统** (`app/utils/response_formatter.py`)
   - 统一API和WebSocket响应格式
   - 多层错误处理和用户友好提示
   - 响应质量验证和优化

## 📁 项目目录结构

```
竞赛智能客服系统/
├── app/                        # 主应用程序目录
│   ├── models/                 # 核心模型组件
│   │   ├── enhanced_rag.py     # 增强型RAG引擎
│   │   ├── enhanced_mcp.py     # 增强型MCP引擎  
│   │   ├── query_router.py     # 查询路由器
│   │   ├── structured_kb.py    # 结构化知识库
│   │   ├── SimpleRAG.py        # 简化RAG实现
│   │   └── SimpleMCPWithRAG.py # 基础MCP+RAG集成
│   ├── utils/                  # 工具类
│   │   ├── question_enhancer.py # 问题增强工具
│   │   ├── response_formatter.py # 响应格式化工具
│   │   ├── middleware.py       # 请求中间件
│   │   └── jieba_helper.py     # 中文分词工具
│   ├── templates/              # 前端模板
│   │   └── index.html          # 主页面 - 竞赛智能客服系统
│   ├── config.py               # 系统配置
│   └── main.py                 # 主程序入口
├── data/                       # 数据目录
│   ├── knowledge/              # 知识资源
│   │   ├── docs/附件1/         # 原始PDF竞赛文档
│   │   ├── txt/               # 预处理文本版本
│   │   └── index/             # 搜索索引
│   ├── kb/                    # 结构化知识库
│   └── stopwords/             # 中文停用词表
├── logs/                      # 日志文件
│   └── app.log               # 系统运行日志（支持DEBUG级别）
├── requirements.txt           # Python依赖
├── run.py                    # 系统启动脚本
└── README.md                 # 项目说明文档
```

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 现代浏览器（Chrome、Firefox、Edge等）
- Windows 10+ / Linux / macOS

### 安装和启动

1. **克隆项目**：
   ```bash
   git clone <repository-url>
   cd teddy-cup
   ```

2. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

3. **启动系统**：
   ```bash
   python run.py
   ```

4. **访问系统**：
   打开浏览器访问 http://localhost:53085

### 系统配置

系统启动后会自动：
- 加载296个竞赛文档
- 构建包含2329个关键词的搜索索引  
- 初始化双引擎问答系统
- 配置DEBUG级别日志记录

## 💡 核心功能

### 1. 竞赛信息查询
- **基础信息**：报名时间、参赛条件、赛题类型
- **详细要求**：技术要求、提交格式、评分标准
- **奖项设置**：奖励机制、证书说明

### 2. 智能问答引擎
- **精确匹配**：结构化知识库确保常见问题100%准确回答
- **语义理解**：智能处理"如何"、"为什么"等开放性问题
- **上下文记忆**：支持多轮对话和会话管理

### 3. 实时调试功能
- **DEBUG日志**：详细的请求处理链路记录
- **系统诊断**：实时监控组件状态和性能
- **错误追踪**：完整的异常堆栈信息记录

### 4. 前端交互体验
- **响应式设计**：适配各种屏幕尺寸
- **实时WebSocket**：即时问答，无需页面刷新
- **功能展示**：清晰的系统功能说明和示例问题
- **竞赛导航**：16个竞赛类型的快速选择

## 🔧 使用指南

### 问题提问技巧

1. **明确竞赛类型**：
   ```
   ✅ 推荐：泰迪杯数据挖掘挑战赛的报名时间是什么时候？
   ❌ 避免：比赛什么时候开始？
   ```

2. **具体信息类型**：
   ```
   ✅ 推荐：3D编程模型创新设计专项赛有哪些技术要求？
   ❌ 避免：这个比赛怎么样？
   ```

3. **支持的问题类型**：
   - 时间查询：报名时间、比赛时间、截止日期
   - 要求查询：参赛条件、技术要求、作品要求
   - 标准查询：评分标准、评判流程
   - 奖励查询：奖项设置、证书说明
   - 流程查询：报名流程、提交流程

### API接口使用

#### 问答接口 (/api/ask)

**请求示例**：
```bash
curl -X POST "http://localhost:53085/api/ask" \
  -H "Content-Type: application/json" \
  -d '{"text": "泰迪杯有哪些赛题类型？", "session_id": "test_session"}'
```

**响应格式**：
```json
{
    "answer": "详细的竞赛回答内容...",
    "confidence": 0.95,
    "has_answer": true,
    "processing_time": 0.25,
    "timestamp": 1734567890,
    "session_id": "test_session"
}
```

#### WebSocket实时问答 (/ws)

**连接示例**：
```javascript
const ws = new WebSocket('ws://localhost:53085/ws');
ws.onopen = function() {
    ws.send(JSON.stringify({
        text: "智能芯片与计算思维专项赛的评分标准是什么？",
        session_id: "ws_session"
    }));
};
```

## 🛠️ 系统维护

### 索引重建

当知识库更新时，重建搜索索引：
```bash
python force_rebuild_index.py
```

### 日志监控

系统提供详细的DEBUG日志，实时监控：
```bash
tail -f logs/app.log
```

主要日志标识：
- `[API问答]`：HTTP API请求处理
- `[WebSocket问答]`：WebSocket消息处理  
- `[查询路由]`：查询引擎路由决策
- `[结构化查询]`：结构化知识库查询
- `[语义搜索]`：RAG语义搜索过程

### 系统诊断

访问系统状态接口：
```bash
curl http://localhost:53085/api/status
```

## 📊 性能指标

根据测试验证：
- **回答准确率**：≥ 85%（结构化问题接近100%）
- **响应时间**：< 2秒（平均0.5-1秒）
- **系统稳定性**：7x24小时连续运行
- **并发支持**：支持多用户同时使用
- **知识覆盖**：16个竞赛类型，296个文档

## 🔍 故障排查

### 常见问题

1. **系统无法启动**
   ```bash
   # 检查依赖
   pip install -r requirements.txt
   
   # 检查端口占用
   netstat -an | findstr :53085
   ```

2. **前端无响应**
   ```bash
   # 检查WebSocket连接
   # 打开浏览器开发者工具查看网络选项卡
   
   # 检查系统日志
   tail -f logs/app.log
   ```

3. **回答质量不佳**
   ```bash
   # 重建索引
   python force_rebuild_index.py
   
   # 查看DEBUG日志了解处理过程
   grep "\[API问答\]\|\[查询路由\]" logs/app.log
   ```

### 日志分析

重要日志模式：
```bash
# 查看请求处理流程
grep "收到问题\|问题处理完成" logs/app.log

# 查看引擎选择决策
grep "查询路由" logs/app.log

# 查看错误信息
grep "ERROR" logs/app.log
```

## 🔄 更新历史

### v5.0.0 (2025-05-25) - 当前版本
- ✅ 实现双引擎查询架构（结构化+语义搜索）
- ✅ 完善DEBUG日志系统，支持实时问题追踪
- ✅ 优化前端界面，展示16个竞赛类型
- ✅ 增强WebSocket稳定性和错误处理
- ✅ 实现统一响应格式化和错误处理

### v4.x 历史版本
- 解决"答非所问"问题
- 实现问题增强和质量评估
- 优化RAG检索算法
- 完善系统架构和组件设计

## 📞 技术支持

- **问题反馈**：查阅 `问题汇总` 文档
- **开发调试**：启用DEBUG日志查看详细处理过程
- **系统监控**：通过 `/api/status` 接口获取系统状态
- **性能分析**：查看 `logs/app.log` 了解响应时间和处理详情

## 📋 系统要求总结

本系统完全满足泰迪杯竞赛要求：

1. ✅ **AI技术应用**：RAG + MCP + 自然语言处理
2. ✅ **数据处理能力**：296个PDF文档，2329个关键词索引
3. ✅ **功能完整性**：基础查询 + 统计分析 + 开放性问题
4. ✅ **实时更新**：支持知识库动态重建和更新
5. ✅ **系统稳定性**：完善的错误处理和日志系统
6. ✅ **用户体验**：美观界面 + 实时交互 + 功能展示

## 🎯 项目亮点

- **创新技术架构**：双引擎设计确保精确性和灵活性并存
- **工程化水准**：完善的日志、错误处理、测试体系
- **用户体验优先**：响应式设计，实时反馈，功能清晰
- **可维护性强**：模块化设计，统一接口，详细文档
- **性能优异**：快速响应，高准确率，稳定运行


## 联系方式（欢迎联系邮箱，批判指正）
项目所需包请联系第一个邮箱获取（数量巨大）
- zjw123456_123@qq.com(架构和MCP)
- 2782106855@qq.com（pdf提取和数据处理）
- 2381914859@qq.com（问答引擎）
  
*竞赛智能客服系统 - 让竞赛信息获取更智能、更高效
